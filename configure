#!/bin/sh

config_binary=""
include_base=""

if command -v mysql_config ; then
  include_base="mysql"
  config_binary=`command -v mysql_config`
fi

if command -v mariadb_config ; then
  include_base="mariadb"
  config_binary=`command -v mariadb_config`
fi

if [ -z "$config_binary" ]; then
  echo "Could not find mariadb_config/mysql_config" 1>&2
  exit 1
fi

mariadb_config_cflags=`$config_binary --cflags`
mariadb_config_libs=`$config_binary --libs`

echo "mariadb_include_base: ................................ $include_base"
echo "mariadb_config_cflags: ............................... $mariadb_config_cflags"
echo "mariadb_config_libs: ................................. $mariadb_config_libs"

cat << EOF > setup.data
mariadb_include_base="$include_base"
mariadb_config_cflags="$mariadb_config_cflags"
mariadb_config_libs="$mariadb_config_libs"
EOF

# OASIS_START
# DO NOT EDIT (digest: dc86c2ad450f91ca10c931b6045d0499)
set -e

FST=true
for i in "$@"; do
  if $FST; then
    set --
    FST=false
  fi

  case $i in
    --*=*)
      ARG=${i%%=*}
      VAL=${i##*=}
      set -- "$@" "$ARG" "$VAL"
      ;;
    *)
      set -- "$@" "$i"
      ;;
  esac
done

ocaml setup.ml -configure "$@"
# OASIS_STOP
